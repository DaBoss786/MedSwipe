<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Mobile Optimization Meta Tags -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#E6F0FA">
  <title>MedSwipe</title>
  
  <!-- Favicon -->
  <link rel="icon" href="icons/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
  
  <!-- Google Fonts: Roboto -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
  
  <!-- Swiper CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css" />
  
  <script src="https://www.google.com/recaptcha/enterprise.js?render=6Ld2rk8rAAAAAG4cK6ZdeKzASBvvVoYmfj0107Ag"></script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="styles.css">
  <link rel="manifest" href="manifest.json">

  <style>
    .redirect-checking {
      opacity: 0 !important;
      pointer-events: none !important;
    }
    
    /* Prevent any content from showing during check */
    #splashScreen, #welcomeScreen, #loginScreen, .main-content {
      transition: opacity 0.1s ease;
    }
    
    /* NEW: Hide ALL content by default for potential redirects */
    .hide-for-redirect #splashScreen,
    .hide-for-redirect .toolbar,
    .hide-for-redirect #mainOptions,
    .hide-for-redirect #bottomToolbar,
    .hide-for-redirect .dashboard-container {
      display: none !important;
    }
  </style>

</head>
<body>
    <!-- Splash Screen Container -->
<div id="splashScreen" class="splash-screen">
  <div class="splash-content">
    <img src="MedSwipe Logo gradient.png" alt="MedSwipe Logo" class="splash-logo">
    <div class="splash-loader">
      <div class="loading-bar"></div>
    </div>
  </div>
</div>

<!-- Welcome Screen Container -->
<div id="welcomeScreen" class="welcome-screen">
  <div class="welcome-content">
    <img src="MedSwipe Logo gradient.png" alt="MedSwipe Logo" class="welcome-logo">
    <h1 class="welcome-tagline">Swipe. Learn. <span class="gradient-text">Master ENT.</span></h1>
    <div class="welcome-buttons">
      <button id="startLearningBtn" class="welcome-primary-btn">Start Learning</button>
      <button id="existingAccountBtn" class="welcome-secondary-btn">I Already Have an Account</button>
    </div>
  </div>
</div>

<!-- ================================= -->
<!-- == NEW Specialty Pick Screen == -->
<!-- ================================= -->
<div id="specialtyPickScreen" class="onboarding-screen" style="display: none;">
  <div class="onboarding-content">
    <img src="MedSwipe Logo gradient.png" alt="MedSwipe Logo" class="onboarding-logo">
    <h1 class="onboarding-title">Choose Your Specialty</h1>
    <p class="onboarding-subtitle">Select the area you'd like to focus on. More specialties coming soon!</p>
    
    <div class="onboarding-options-grid">
      <button class="onboarding-option-card" data-specialty="ENT">
        ENT (Otolaryngology)
      </button>
      <!-- Add more specialty cards here in the future -->
      <!-- Example:
      <button class="onboarding-option-card disabled-option" data-specialty="Cardiology" disabled>
        <span class="onboarding-option-icon">‚ù§Ô∏è</span>
        Cardiology (Coming Soon)
      </button>
      -->
    </div>
    
    <button id="specialtyContinueBtn" class="onboarding-primary-btn" disabled>Continue</button>
  </div>
</div>
<!-- ================================= -->
<!-- == END Specialty Pick Screen   == -->
<!-- ================================= -->

<!-- ===================================== -->
<!-- == NEW Experience Level Pick Screen == -->
<!-- ===================================== -->
<div id="experiencePickScreen" class="onboarding-screen" style="display: none;">
  <div class="onboarding-content">
    <img src="MedSwipe Logo gradient.png" alt="MedSwipe Logo" class="onboarding-logo">
    <h1 class="onboarding-title">Select Your Experience Level</h1>
    <p class="onboarding-subtitle">This helps us tailor content for you.</p>
    
    <div class="onboarding-options-list"> <!-- Using a list/column layout for experience -->
      <button class="onboarding-option-button" data-experience="Medical Student">Medical Student</button>
      <button class="onboarding-option-button" data-experience="PGY 1-2">PGY 1-2</button>
      <button class="onboarding-option-button" data-experience="PGY 3-4">PGY 3-4</button>
      <button class="onboarding-option-button" data-experience="PGY 5+">PGY 5+</button>
      <button class="onboarding-option-button" data-experience="Attending">Attending</button>
      <button class="onboarding-option-button" data-experience="Other">Other</button>
    </div>
    
    <button id="experienceContinueBtn" class="onboarding-primary-btn" disabled>Continue</button>
  </div>
</div>
<!-- ===================================== -->
<!-- == END Experience Level Pick Screen == -->
<!-- ===================================== -->

<!-- ===================================== -->
<!-- == NEW Username Pick Screen        == -->
<!-- ===================================== -->
<div id="usernamePickScreen" class="onboarding-screen" style="display: none;">
  <div class="onboarding-content">
    <img src="MedSwipe Logo gradient.png" alt="MedSwipe Logo" class="onboarding-logo">
    <h1 class="onboarding-title">Create Your Username</h1>
    <p class="onboarding-subtitle">This will be displayed on leaderboards. You can change it anytime later.</p>
    
    <div class="form-group" style="width: 100%; max-width: 320px; margin-bottom: 30px;">
      <input type="text" id="onboardingUsernameInput" placeholder="Enter your username" required minlength="3" style="text-align: center; font-size: 1.1rem; padding: 12px;">
      <div class="form-error" id="onboardingUsernameError" style="min-height: 20px; margin-top: 8px;"></div>
    </div>
    
    <button id="usernameContinueBtn" class="onboarding-primary-btn" disabled>Continue</button>
  </div>
</div>
<!-- ===================================== -->
<!-- == END Username Pick Screen        == -->
<!-- ===================================== -->

  <!-- Onboarding Loading Screen -->
<div id="onboardingLoadingScreen" class="loading-screen">
  <div class="loading-content">
    <img src="MedSwipe Logo gradient.png" alt="MedSwipe Logo" class="loading-logo">
    <div class="loading-spinner"></div>
    <p class="loading-text">Curating your first three questions...</p>
  </div>
</div>

<!-- =================================== -->
<!-- == NEW Onboarding Carousel       == -->
<!-- =================================== -->
<div id="onboardingCarousel" style="display: none;">
  <!-- "Skip" button positioned in the corner -->
  <button id="onboardingSkipBtn" class="onboarding-skip-btn">Skip</button>

  <!-- Swiper container for the slides -->
  <div class="swiper-container onboarding-swiper-container">
    <div class="swiper-wrapper">
      
      <!-- Slide 1: Welcome -->
      <div class="swiper-slide">
        <div class="onboarding-slide-content">
          <h2 class="onboarding-headline">Smarter prep starts here.</h2>
          <p class="onboarding-text">Quick, swipe-based review made for busy residents and attendings.</p>
          <img src="onboarding-visual-1.png" alt="MedSwipe Interface" class="onboarding-visual">
        </div>
      </div>

      <!-- Slide 2: Track Progress -->
      <div class="swiper-slide">
        <div class="onboarding-slide-content">
          <h2 class="onboarding-headline">Compete, track, improve.</h2>
          <p class="onboarding-text">See your stats, earn XP, and climb the leaderboard.</p>
          <img src="onboarding-visual-2.png" alt="Progress Tracking" class="onboarding-visual">
        </div>
      </div>

      <!-- Slide 3: Case Prep -->
      <div class="swiper-slide">
        <div class="onboarding-slide-content">
          <h2 class="onboarding-headline">Master the OR with <i>Case Prep</i></h2>
          <p class="onboarding-text">New <i>Case Prep</i> mode designed to help you prep for common procedures and typical "pimping" questions.</p>
          <img src="onboarding-visual-3.png" alt="Case Prep" class="onboarding-visual">
        </div>
      </div>

      <!-- Slide 4: CME -->
      <div class="swiper-slide">
        <div class="onboarding-slide-content">
          <h2 class="onboarding-headline">Swipe, learn, get credit.</h2>
          <p class="onboarding-text">Earn up to 24 <i>AMA PRA Category 1 Credits‚Ñ¢</i>. CME. Anytime, anywhere.</p>
          <img src="onboarding-visual-4.png" alt="CME Credits" class="onboarding-visual">
        </div>
      </div>

            <!-- START: NEW Social Proof Slide -->
            <div class="swiper-slide">
              <div class="onboarding-slide-content">
                <h2 class="onboarding-headline">Trusted by Your Peers.</h2>
                <p class="onboarding-text">MedSwipe is the study tool of choice for busy residents and attendings.</p>
      
                <!-- Testimonial Container -->
                <div class="onboarding-testimonials">
                  <!-- Testimonial 1 -->
                  <div class="testimonial">
                    <div class="testimonial-author">
                      <div class="author-avatar">JS</div>
                      <div class="author-info">
                        <h4>Dr. JS</h4>
                        <p>Rhinology Fellow</p>
                      </div>
                    </div>
                    <p class="testimonial-quote">"MedSwipe was a valuable learning tool and helped me pass my boards. Loved being able to get through questions between cases."</p>
                  </div>
      
                  <!-- Testimonial 2 -->
                  <div class="testimonial">
                    <div class="testimonial-author">
                      <div class="author-avatar">MA</div>
                      <div class="author-info">
                        <h4>Dr. MA</h4>
                        <p>PGY-3, Otolaryngology Resident</p>
                      </div>
                    </div>
                    <p class="testimonial-quote">"I have been using the Case Prep mode before my cases and it has been a game changer. I feel much more confident going into the OR."</p>
                  </div>
                </div>
              </div>
            </div>
            <!-- END: NEW Social Proof Slide -->

      <!-- Slide 5: Get Started -->
      <div class="swiper-slide">
        <div class="onboarding-slide-content">
          <img src="MedSwipe Logo gradient.png" alt="MedSwipe Logo" class="onboarding-visual-logo">
          <h2 class="onboarding-headline">Start swiping now.</h2>
          <p class="onboarding-text">Your learning journey begins here. Get started for free.</p>
        </div>
      </div>

    </div>
    <!-- Swiper Pagination Dots -->
    <div class="swiper-pagination"></div>
  </div>

  <!-- Navigation button at the bottom -->
  <div class="onboarding-nav">
    <button id="onboardingNextBtn" class="onboarding-next-btn">Next</button>
  </div>
</div>
<!-- =================================== -->
<!-- == END Onboarding Carousel       == -->
<!-- =================================== -->

  <!-- Login Screen Container -->
<div id="loginScreen" class="login-screen">
  <div class="login-content">
    <div class="login-header">
      <img src="MedSwipe Logo gradient.png" alt="MedSwipe Logo" class="login-logo">
      <h1 class="login-title">Welcome Back</h1>
    </div>

        <div class="oauth-button-group">
      <button type="button" class="oauth-button oauth-button--google" data-oauth-provider="google" data-oauth-context="login-screen">
        <img src="google-icon.svg" alt="" class="oauth-button__icon" aria-hidden="true">
        <span class="oauth-button__label">Continue with Google</span>
      </button>
      <button type="button" class="oauth-button oauth-button--apple" data-oauth-provider="apple" data-oauth-context="login-screen">
        <svg class="oauth-button__icon" aria-hidden="true" viewBox="0 0 16 16" focusable="false">
          <path fill="currentColor" d="M12.66 7.07c-.01-1.22.55-2.24 1.77-2.96-.67-.99-1.68-1.54-2.87-1.64-1.2-.1-2.35.7-2.97.7-.64 0-1.64-.68-2.7-.66-1.39.02-2.7.82-3.42 2.07-1.46 2.53-.37 6.27 1.04 8.33.69.99 1.52 2.11 2.6 2.07 1.04-.04 1.43-.67 2.68-.67 1.24 0 1.59.67 2.69.65 1.11-.02 1.82-1 2.5-1.99.78-1.14 1.1-2.25 1.12-2.31-.02-.01-2.14-.82-2.15-3.59zM10.26 1.86c.61-.74 1.02-1.78.91-2.82-.88.04-1.94.61-2.56 1.35-.56.66-1.05 1.72-.92 2.73.97.08 1.96-.49 2.57-1.26z" />
        </svg>
        <span class="oauth-button__label">Continue with Apple</span>
      </button>
    </div>
    <div class="oauth-divider"><span>or</span></div>
    <form id="loginScreenForm" class="login-form">
      <div class="form-group">
        <label for="loginScreenEmail">Email</label>
        <input type="email" id="loginScreenEmail" required autocomplete="email">
        <div class="form-error" id="emailError"></div>
      </div>
      
      <div class="form-group">
        <label for="loginScreenPassword">Password</label>
        <div class="password-container">
          <input type="password" id="loginScreenPassword" required autocomplete="current-password">
          <button type="button" class="password-toggle" id="passwordToggle" aria-label="Toggle password visibility">
            <i class="eye-icon">üëÅÔ∏è</i>
          </button>
        </div>
        <div class="form-error" id="passwordError"></div>
      </div>
      
      <div class="login-actions">
        <button type="submit" id="loginScreenSubmit" class="login-button" disabled>Log In</button>
        <a href="#" id="forgotPasswordLink" class="login-link">Forgot Password?</a>
      </div>
    </form>
    
    <div class="login-divider">
      <span>or</span>
    </div>
    
    <div class="login-alternative-options">
      <button id="createAccountBtn" class="secondary-button">Create Account</button>
      <button id="continueAsGuestBtn" class="auth-secondary-btn" onclick="document.getElementById('registrationBenefitsModal').style.display='none'; document.getElementById('mainOptions').style.display='flex';">Continue as Guest</button>
    </div>
    
    <div id="loginScreenError" class="login-error-message"></div>
  </div>
  
  <div class="login-loader" id="loginLoader">
    <div class="spinner"></div>
    <p>Logging in...</p>
  </div>
</div>

<!-- Post Registration Loading Screen -->
<div id="postRegistrationLoadingScreen" class="loading-screen" style="display: none;">
  <div class="loading-content">
    <img src="MedSwipe Logo gradient.png" alt="MedSwipe Logo" class="loading-logo">
    <div class="loading-spinner"></div>
    <p class="loading-text">Finalizing your account...</p>
  </div>
</div>

<!-- ========================== -->
<!-- == Paywall Screens == -->
<!-- ========================== -->
<div id="newPaywallScreen" class="paywall-screen" style="display: none;">
  <div id="webPaywallContent" class="paywall-content">
    <img src="MedSwipe Logo gradient.png" alt="MedSwipe Logo" class="paywall-logo">
    <h1 class="paywall-title">Choose Your MedSwipe Experience</h1>
    <p class="paywall-subtitle">From board/in-service prep to CME credits, we have a plan for you.</p>

    <div class="paywall-options-container">

      <!-- Option 1: Free Access Card -->
      <div class="paywall-option-card free-access-card">
        <h2>Free Access <span class="price-details">A taste of our core learning tools.</span></h2>
        <ul>
          <li><span class="check-icon">‚úî</span><span>Access foundational anatomy & general questions</span></li>
          <li><span class="check-icon">‚úî</span><span>Enjoy basic quiz functionality to see how MedSwipe works</span></li>
          <li><span class="check-icon">‚úî</span><span>Upgrade Anytime: Unlock advanced features like leaderboards, spaced repetition, and the full QBank</span></li>
        </ul>
        <button id="continueFreeAccessBtn" class="paywall-continue-guest-btn">Try Free Version</button>
      </div>

      <!-- Option 2: Board Review Access -->
      <div class="paywall-option-card board-review-card">
        <div class="card-badge popular-badge">MOST POPULAR</div>
        <h2>Board and In-Service Review</h2>
        <p class="price-highlight">$15/month</p>
        <p class="price-details price-secondary-line">$40/3 months or $149/year options available</p>
        <ul>
          <li><span class="check-icon">‚úî</span><span>Pass your boards with confidence with 800+ high-yield, board-style questions</span></li>
          <li><span class="check-icon">‚úî</span><span>Access to <i>Case Prep</i> mode to get curated "pimp" questions for your upcoming cases</span></li>
          <li><span class="check-icon">‚úî</span><span>Intelligent spaced repetition & competitive leaderboards</span></li>
          <li><span class="check-icon">‚úî</span><span>Advanced analytics to focus your study</span></li>
          <li><span class="check-icon">‚úî</span><span>Mobile-first design allows for learning on the go</span></li>
        </ul>
        <button id="unlockBoardReviewBtn" class="paywall-select-btn">Get Started - $0.00 today for 7 days</button>
      </div>

      <!-- Option 3: CME Module -->
      <div class="paywall-option-card cme-module-card">
        <div class="card-badge cme-eligible-badge">CME ELIGIBLE</div>
        <h2>Earn CME Credits Effortlessly</h2>
        <p class="price-highlight">$179/year <span id="cmePaywallPriceDetail" class="price-details">or $8 per credit</span></p>
        <ul>
          <li><span class="check-icon">‚úî</span><span>Over 60% less than competitors</span></li>
          <li><span class="check-icon">‚úî</span><span>Earn up to 24  <i>AMA PRA Category 1 Credits</i></span></li>
          <li><span class="check-icon">‚úî</span><span>Re-do missed questions and still gain credits</span></li>
          <li><span class="check-icon">‚úî</span><span>Download certificates anytime, anywhere</span></li>
          <li><span class="check-icon">‚úî</span><span>Includes everything in the Board Review Tier</span></li>
        </ul>
        <button id="exploreCmeModuleBtn" class="paywall-select-btn">Get Started - $0.00 today for 7 days</button>
      </div>

    </div>
    <div class="paywall-restore-container">
      <button id="restorePurchasesBtn" class="paywall-restore-btn" type="button">Restore Purchases</button>
    </div>
  </div>

  <div id="iosPaywallContent" class="ios-paywall-root" style="display: none;">
    <img src="MedSwipe Logo gradient.png" alt="MedSwipe Logo" class="ios-paywall-logo" loading="lazy">
    <h1 class="ios-paywall-title">Choose Your Plan</h1>
    <p class="ios-paywall-subtitle">Unlock your medical learning potential.</p>

    <div class="ios-plan-selector" role="tablist">
      <button class="ios-plan-selector-btn" data-plan="free" role="tab" aria-selected="false">Free</button>
      <button class="ios-plan-selector-btn active" data-plan="board" role="tab" aria-selected="true">Board Review</button>
      <button class="ios-plan-selector-btn" data-plan="cme" role="tab" aria-selected="false">CME</button>
    </div>

    <div class="ios-paywall-card-stack">
      <section class="ios-paywall-card free-access-card" data-plan-card="free" role="tabpanel" aria-hidden="true">
        <span class="ios-card-badge">Always Included</span>
        <h2>Free Access</h2>
        <p class="ios-price-highlight">
          $0
          <span class="ios-price-details">forever</span>
        </p>
        <p class="ios-price-details ios-price-secondary-line">A taste of our core learning tools.</p>
        <ul id="iosFreeFeatures" class="ios-feature-stack"></ul>
        <button id="iosContinueFreeBtn" class="ios-paywall-secondary-btn">Try Free Version</button>
      </section>

      <section class="ios-paywall-card board-review-card active" data-plan-card="board" role="tabpanel" aria-hidden="false">
        <span class="ios-card-badge ios-popular-badge" id="iosBoardBadge">Most Popular</span>
        <h2>Board Review Access</h2>
        <div class="ios-board-toggle" role="tablist">
          <button class="active" data-cycle="monthly" aria-selected="true">Monthly</button>
          <button data-cycle="quarterly" aria-selected="false">3-Month</button>
          <button data-cycle="annual" aria-selected="false">Annual</button>
        </div>
        <p class="ios-price-highlight">
          <span id="iosBoardPriceValue">$15</span>
          <span class="ios-price-details" id="iosBoardPriceInterval">/month</span>
        </p>
        <p class="ios-price-details ios-price-secondary-line" id="iosBoardPriceCopy" style="display: none;"></p>
        <ul id="iosBoardFeatures" class="ios-feature-stack"></ul>
        <button id="iosBoardCta" class="ios-paywall-primary-btn">Start 7-Day Free Trial</button>
      </section>

      <section class="ios-paywall-card cme-module-card" data-plan-card="cme" role="tabpanel" aria-hidden="true">
        <span class="ios-card-badge ios-cme-badge">CME Eligible</span>
        <h2>CME Access</h2>
        <p class="ios-price-highlight">
          $179
          <span class="ios-price-details">per year</span>
        </p>
        <ul id="iosCmeFeatures" class="ios-feature-stack"></ul>
        <button id="iosCmeCta" class="ios-paywall-primary-btn">Start 7-Day Free Trial</button>
      </section>
    </div>

    <div class="ios-inline-links" data-after-card="cme">
      <button class="ios-text-link" type="button" data-link="accreditation">Accreditation Statement</button>
      <button class="ios-text-link" type="button" data-link="learn-more">Learn More</button>
    </div>

    <footer class="ios-paywall-footer">
      <button id="iosRestorePurchasesBtn" class="ios-restore-btn" type="button">Restore Purchases</button>
    </footer>
  </div>
</div>

<!-- =================================== -->
<!-- == Board Review Pricing Screen == -->
<!-- =================================== -->
<div id="boardReviewPricingScreen" class="pricing-screen-general" style="display: none;">
  <button id="boardReviewPricingBackBtn" class="cme-back-btn">‚Üê Back to Plans</button> <!-- Re-use cme-back-btn style -->

  <div class="pricing-content-general">
    <img src="MedSwipe Logo gradient.png" alt="MedSwipe Logo" class="pricing-logo-general">
    <h1 class="pricing-title-general">Board Review Access</h1>
    <p class="pricing-subtitle-general">Unlock the full question bank, leaderboards, and advanced analytics.</p>

    <div class="pricing-toggle-general">
      <button id="brMonthlyBtn" class="toggle-btn-general">MONTHLY</button>
      <button id="br3MonthBtn" class="toggle-btn-general">3-MONTH</button>
      <button id="brAnnualBtn" class="toggle-btn-general active">ANNUAL</button> <!-- Annual active by default -->
    </div>

    <!-- Monthly Plan Details -->
    <div id="brMonthlyContent" class="pricing-plan-content" style="display: none;">
      <div class="price-display-general">$15<span class="price-interval-general">/month</span></div>
      <ul class="feature-list-general">
        <li><span class="check-icon">‚úî</span> Full Question Bank Access - 800+ Questions</li>
        <li><span class="check-icon">‚úî</span> Access to <i>Case Prep</i> mode</li>
        <li><span class="check-icon">‚úî</span> Compete Against Other Residents - Access to Leaderboards</li>
        <li><span class="check-icon">‚úî</span> Spaced Repetition and Advanced Category Analytics</li>
        <li><span class="check-icon">‚úî</span> Billed monthly, cancel anytime</li>
      </ul>
      <button id="checkoutBrMonthlyBtn" class="auth-primary-btn pricing-checkout-btn-general">Start 7-Day Free Trial</button>
    </div>

    <!-- 3-Month Plan Details -->
    <div id="br3MonthContent" class="pricing-plan-content" style="display: none;">
      <div class="price-display-general">$40<span class="price-interval-general">/3 months</span></div>
      <p class="price-savings-general">(Save over 10% vs. monthly!)</p>
      <ul class="feature-list-general">
        <li><span class="check-icon">‚úî</span> Full Question Bank Access - 800+ Questions</li>
        <li><span class="check-icon">‚úî</span> Access to <i>Case Prep</i> mode</li>
        <li><span class="check-icon">‚úî</span> Compete Against Other Residents - Access to Leaderboards</li>
        <li><span class="check-icon">‚úî</span> Spaced Repetition and Advanced Category Analytics</li>
        <li><span class="check-icon">‚úî</span> Billed every 3 months, auto-renews</li>
      </ul>
      <button id="checkoutBr3MonthBtn" class="auth-primary-btn pricing-checkout-btn-general">Start 7-Day Free Trial</button>
    </div>

    <!-- Annual Plan Details -->
    <div id="brAnnualContent" class="pricing-plan-content" style="display: block;"> <!-- Visible by default -->
      <div class="price-display-general">$149<span class="price-interval-general">/year</span></div>
      <p class="price-savings-general">(Best Value! Save over 15% vs. monthly!)</p>
      <ul class="feature-list-general">
        <li><span class="check-icon">‚úî</span> Full Question Bank Access - 800+ Questions</li>
        <li><span class="check-icon">‚úî</span> Access to <i>Case Prep</i> mode</li>
        <li><span class="check-icon">‚úî</span> Compete with Other Residents - Access to Leaderboards</li>
        <li><span class="check-icon">‚úî</span> Spaced Repetition and Advanced Category Analytics</li>
        <li><span class="check-icon">‚úî</span> Billed annually, auto-renews</li>
      </ul>
      <button id="checkoutBrAnnualBtn" class="auth-primary-btn pricing-checkout-btn-general">Start 7-Day Free Trial</button>
    </div>
  </div>
</div>
  
    <!-- Top Toolbar -->
    <div class="toolbar">
      <div class="toolbar-left">
        <button class="menu-button" id="menuToggle">‚ò∞</button>
      </div>
      <div class="toolbar-center">
        <div class="logo" id="logoClick">
          <img src="MedSwipe Logo gradient.png" alt="MedSwipe Logo">
        </div>
      </div>
      <div class="toolbar-right">  <!-- .toolbar-right STARTS HERE -->
        <!-- XP Display -->
        <div id="xpDisplay">0 XP</div>
        <!-- Level with Progress Circle -->
        <div class="level-circle-container" id="mainLevelCircleContainer">
          <div class="level-progress-circle">
            <div class="level-circle-background"></div>
            <div class="level-circle-progress" id="levelCircleProgress"></div>
            <div class="level-number clickable" id="scoreCircle">1</div>
          </div>
        </div>
  
        <!-- ================================= -->
        <!-- == NEW CME Toolbar Tracker     == -->
        <!-- MOVED INSIDE .toolbar-right     == -->
        <!-- ================================= -->
        <div id="cmeToolbarTracker" style="display: none; align-items: center; justify-content: flex-end; gap: 5px;"> <!-- Added gap to match toolbar-right -->
          <div id="cmeCreditsDisplay" style="font-size: 0.9rem; color: #0056b3; font-weight: 500;">CME: 0.00</div>
          <div class="level-circle-container" id="cmeAccuracyCircleContainer">
            <div class="level-progress-circle">
              <div class="level-circle-background"></div>
              <div class="level-circle-progress" id="cmeAccuracyCircleProgress"></div>
              <div class="level-number clickable" id="cmeAccuracyCircleValue">0%</div>
            </div>
          </div>
        </div>
        <!-- ================================= -->
        <!-- == END CME Toolbar Tracker       == -->
        <!-- ================================= -->
      </div> <!-- .toolbar-right ENDS HERE -->
    </div> <!-- .toolbar ENDS HERE -->
  
  <!-- Main Options -->
<!-- Dashboard View with Fixed Spacing and Centered Button -->
<div id="mainOptions" class="dashboard-container">
  <!-- Modified margin-top to move button down so it's fully visible -->
    <!-- START: Corrected Button Layout -->
    <div class="dashboard-start-section" style="display: flex; justify-content: center; width: 100%; margin-top: 55px;">
      <button id="startQuizBtn" class="dashboard-start-btn">Start Quiz</button>
      <button id="cmeModuleBtn" class="start-quiz-btn">CME Module</button>
    </div>
    <div class="dashboard-start-section" style="display: flex; justify-content: center; width: 100%; margin-top: -10px;">
      <button id="casePrepBtn" class="dashboard-start-btn">Case Prep</button>
    </div>
    <!-- END: Corrected Button Layout -->
  
  <!-- First Row: Progress and Stats Cards -->
  <div class="dashboard-cards-row">
    <!-- User Progress Card -->
    <div class="dashboard-card user-progress-card" id="userProgressCard">
      <div class="card-header">
        <h3>Your Progress</h3>
      </div>
      <div class="card-content">
        <div class="level-progress-container">
          <div class="level-progress-circle dashboard-level">
            <div class="level-circle-background"></div>
            <div class="level-circle-progress" id="dashboardLevelProgress"></div>
            <div class="level-number" id="dashboardLevel">1</div>
          </div>
          <div class="level-info">
            <p class="level-xp" id="dashboardXP">0 XP</p>
            <p class="level-next" id="dashboardNextLevel">30 XP to Level 2</p>
          </div>
        </div>
      </div>
      <div class="card-footer">
        <span>View Details</span>
        <span class="arrow-icon">‚Üí</span>
      </div>
    </div>
    
    <!-- Quick Stats Card -->
    <div class="dashboard-card stats-card" id="quickStatsCard">
      <div class="card-header">
        <h3>Quick Stats</h3>
      </div>
      <div class="card-content">
        <div class="quick-stats-container">
          <div class="stats-item">
            <div class="stats-value" id="dashboardAnswered">0</div>
            <div class="stats-label">Questions Answered</div>
          </div>
          <div class="stats-item">
            <div class="stats-value" id="dashboardAccuracy">0%</div>
            <div class="stats-label">Accuracy</div>
          </div>
        </div>
      </div>
      <div class="card-footer">
        <span>View Details</span>
        <span class="arrow-icon">‚Üí</span>
      </div>
    </div>
  </div>

  <!-- START: New Referral Card for Dashboard -->
  <div class="dashboard-card referral-card" id="referralCard" style="width: 100%; margin-bottom: 20px; display: none;"> <!-- Start hidden -->
    <div class="card-header">
        <h3>Refer a Friend, Get a Free Month</h3>
    </div>
    <div class="card-content" style="text-align: center; padding: 15px;">
        <p style="margin: 0; font-size: 0.9rem; color: #555;">Share MedSwipe with a colleague. When they start a trial, you get an extra month of premium access for free!</p>
    </div>
    <div class="card-footer">
        <span>Get Your Referral Link</span>
        <span class="arrow-icon">‚Üí</span>
    </div>
</div>
<!-- END: New Referral Card for Dashboard -->
  
  <!-- Review Queue Card (full width) -->
  <div class="dashboard-card review-queue-card" id="reviewQueueCard" style="width: 100%; margin-bottom: 20px;">
    <div class="card-header">
      <h3>Review Queue</h3>
    </div>
    <div class="card-content">
      <div id="reviewQueueContent" class="review-queue-content">
        <div class="review-stats">
          <div class="review-count" id="reviewCount">0</div>
          <div class="review-label">questions due for review</div>
        </div>
        <div class="review-progress-container">
          <div class="review-progress-bar" id="reviewProgressBar"></div>
        </div>
      </div>
    </div>
    <div class="card-footer">
      <span>Start Review</span>
      <span class="arrow-icon">‚Üí</span>
    </div>
  </div>

    <!-- START: New CME Tracker Card for Dashboard -->
    <div class="dashboard-card cme-tracker-dashboard-card" id="dashboardCmeCard" style="width: 100%; margin-bottom: 20px; display: none;"> <!-- Start hidden -->
        <div class="card-header">
            <h3>CME Tracker</h3>
        </div>
        <div class="card-content">
            <div class="quick-stats-container" style="justify-content: space-around;"> <!-- Re-using quick-stats style -->
                <div class="stats-item">
                    <div class="stats-value" id="dashboardCmeAnswered">0</div>
                    <div class="stats-label">CME Questions Answered</div>
                </div>
                <div class="stats-item">
                    <div class="stats-value" id="dashboardCmeAccuracy">0%</div>
                    <div class="stats-label">Accuracy</div>
                </div>
                <div class="stats-item">
                    <!-- Changed to show AVAILABLE credits -->
                    <div class="stats-value" id="dashboardCmeAvailable">0.00</div>
                    <div class="stats-label">CME Credits Earned</div>
                </div>
            </div>
        </div>
        <div class="card-footer">
            <!-- Footer text as requested, acts as the button -->
            <span>Claim CME Credits</span>
            <span class="arrow-icon">‚Üí</span>
        </div>
    </div>
    <!-- END: New CME Tracker Card for Dashboard -->
  
  <!-- Second Row: Leaderboard Preview Card (full width) -->
  <div class="dashboard-card leaderboard-card" id="leaderboardPreviewCard" style="width: 100%; margin-bottom: 20px;">
    <div class="card-header">
      <h3>Leaderboard</h3>
    </div>
    <div class="card-content">
      <div id="leaderboardPreview">
        <!-- Loading state -->
        <div class="leaderboard-loading">Loading top users...</div>
        <!-- Entries will be populated by JavaScript -->
      </div>
    </div>
    <div class="card-footer">
      <span>View Full Leaderboard</span>
      <span class="arrow-icon">‚Üí</span>
    </div>
  </div>
  
  <!-- Third Row: Streak Calendar Card (Full Width) -->
  <div class="dashboard-card streak-card">
    <div class="card-header">
      <h3>Activity Streak</h3>
      <div class="streak-count">
        <span id="currentStreak">0</span>
        <span class="streak-flame">üî•</span>
      </div>
    </div>
    <div class="card-content">
      <div class="streak-calendar">
        <div class="day-labels">
          <span>M</span>
          <span>T</span>
          <span>W</span>
          <span>T</span>
          <span>F</span>
          <span>S</span>
          <span>S</span>
        </div>
        <div class="day-circles" id="streakCalendar">
          <!-- Days will be filled in by JavaScript -->
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- Quiz Setup Modal -->
<div id="quizSetupModal" class="modalForm modalForm--scrollable">
  <h2>Set Up Your Quiz</h2>
  <div class="formGroup">
    <label for="modalCategorySelect">Select Category</label>
    <select id="modalCategorySelect">
      <option value="">All Categories</option>
      <option value="Head & Neck Surgery">Head & Neck Surgery</option>
      <option value="Otology">Otology</option>
      <option value="Laryngology">Laryngology</option>
      <option value="Rhinology">Rhinology</option>
      <option value="Pediatric ENT">Pediatric ENT</option>
      <option value="Facial Plastics">Facial Plastics</option>
    </select>
  </div>
  <!-- START: New Search Bar -->
  <div class="formGroup" id="searchFormGroup">
    <label for="modalSearchInput">Search by Keyword</label>
    <input type="text" id="modalSearchInput" placeholder="e.g., Sistrunk, cholesteatoma...">
    <p id="modalSearchHelper" class="formHelper">&nbsp;</p> <!-- Helper text will go here -->
  </div>
  <!-- END: New Search Bar -->
  <div class="formGroup">
    <label for="modalNumQuestions">Number of Questions</label>
    <input type="number" id="modalNumQuestions" min="1" value="10">
  </div>
  <div class="formGroup" id="boardReviewOnlyContainer" style="display: none;"> <!-- Start hidden -->
    <label>
      <input type="checkbox" id="modalBoardReviewOnly">
      Board Review Questions Only
    </label>
    <p class="formHelper">Focus on board-style questions</p>
  </div>
  <div class="formGroup">
  <label>
    <input type="checkbox" id="modalIncludeAnswered">
    Include answered questions
  </label>
</div>
  <div class="formGroup">
  <label>
    <input type="checkbox" id="modalSpacedRepetition">
    Enable Spaced Repetition
  </label>
  <p class="formHelper">Mix new questions with questions due for review</p>
</div>
  <div class="btnRow">
    <button id="modalStartQuiz">Start Quiz</button>
    <button id="modalCancelQuiz" class="cancel">Cancel</button>
  </div>
</div>

<!-- START: New Case Prep Modals -->

<!-- One-Time Intro Modal -->
<div id="casePrepIntroModal" class="modal" style="display: none; z-index: 2110;">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Welcome to Case Prep</h2>
      <span id="closeCasePrepIntroBtn" class="close-modal">√ó</span>
    </div>
    <div class="modal-body">
      <p style="line-height: 1.6; font-size: 1rem;">
        This section helps you quickly review surgical anatomy, steps, complications, and common intraoperative ‚Äòpimp‚Äô questions that attendings may ask. Designed for ENT residents prepping for the OR.
      </p>
      <div class="auth-buttons" style="margin-top: 25px;">
        <button id="continueCasePrepBtn" class="auth-primary-btn">Continue</button>
      </div>
    </div>
  </div>
</div>

<!-- Case Prep Setup Modal -->
<div id="casePrepSetupModal" class="modalForm" style="display: none; z-index: 2100;">
  <h2>Case Prep Setup</h2>
  <div class="formGroup">
    <label for="casePrepProcedureSelect">Select a Procedure</label>
    <select id="casePrepProcedureSelect">
      <!-- Options will be populated by JavaScript -->
      <option value="">--Please choose a procedure--</option>
    </select>
  </div>
  <div class="formGroup">
    <label for="casePrepNumQuestions">Number of Questions</label>
    <input type="number" id="casePrepNumQuestions" min="1" value="10">
  </div>
  <div class="formGroup">
    <label>
      <input type="checkbox" id="casePrepIncludeAnswered">
      Include already answered questions
    </label>
  </div>
  <div class="btnRow">
    <button id="startCasePrepBtn">Start Prep</button>
    <button id="cancelCasePrepBtn" class="cancel">Cancel</button>
  </div>
</div>

<!-- END: New Case Prep Modals -->
  
  <!-- Remaining HTML is unchanged -->
  <!-- Swiper Container for Quiz -->
  <div class="swiper">
    <div class="swiper-wrapper" id="quizSlides"></div>
  </div>
  
  <!-- Bottom Toolbar for Quiz -->
  <div id="bottomToolbar" style="display: none;">
    <div id="progressBarContainer">
      <div id="progressBar"></div>
    </div>
    <div id="questionProgress">0 / 0</div>
    <div id="scoreDisplay">Score: 0</div>
  </div>
  
  <!-- Performance View -->
  <div id="performanceView" style="display: none;"></div>
  
  <!-- Leaderboard View -->
  <div id="leaderboardView"></div>
  
  <!-- FAQ View -->
  <div id="faqView"></div>
  
  <!-- About Us View -->
  <div id="aboutView"></div>
  
  <!-- Side Menu with Close Button (Left) -->
  <div id="sideMenu">
    <div id="menuHeader">
      <span id="menuTitle">Menu</span>
      <span id="menuClose" style="cursor:pointer;">&times;</span>
    </div>
    <ul id="menuList">
      <li id="startNewQuiz">Start New Quiz</li>
      <li id="leaderboardItem">Leaderboard</li>
      <li id="faqItem">FAQ</li>
      <li id="cmeInfoMenuItem">CME Module Info</li>
      <li id="aboutItem">About Us</li>
      <li id="contactItem">Contact Us</li>
      <li id="tosMenuItem">Terms of Service</li>
      <li id="privacyMenuItem">Privacy Policy</li>
    </ul>
  </div>
  
   <!-- User Menu with Close Button (Right) -->
   <div id="userMenu">
    <div class="user-menu-content">
      <div id="userMenuHeader">
        <span id="menuTitle">Profile</span>
        <span id="userMenuClose" style="cursor:pointer;">√ó</span>
      </div>
      <div id="userInfoSection">
        <h3 id="usernameDisplay">Username</h3>
        <div class="user-score-container">
          <p>Level</p>
          <div class="level-progress-circle">
            <div class="level-circle-background"></div>
            <div class="level-circle-progress" id="userLevelProgress"></div>
            <div class="level-number clickable" id="userScoreCircle">1</div>
          </div>
          <div id="userXpDisplay">0/30 XP</div>
          <div class="level-progress-bar-container">
            <div class="level-progress-bar" id="levelProgressBar"></div>
          </div>
        </div>
      </div>
      <ul id="userMenuList">
        <!-- "Subscribe" button moved higher for free_guest -->
        <li id="subscribeMenuItemUser" style="display: none;"> <!-- Initially hidden -->
            <a href="#">
               
                <span>Subscribe to Premium</span> <!-- More descriptive text -->
            </a>
        </li>
        <li id="registerMenuItem" style="display: none;">
          <a href="#">
              <span>Register Now</span>
          </a>
        </li>
        <li id="guestLoginMenuItem" style="display: none;">
          <a href="#">
               <span>Log In</span>
          </a>
      </li>
      <li id="editProfileMenuItem">Account Settings</li>
        <li id="performanceItemUser">Performance</li>
        <li><a href="#" id="bookmarksFilterUser">Bookmarks</a></li>
        <li id="cmeHistoryMenuItem">View CME Claim History</li>
        <li id="manageSubscriptionBtn" style="display: none;">Manage Subscription</li>
        <li><a href="#" id="resetProgressUser">Reset Progress</a></li>
        <li id="logoutUserBtn" style="margin-top: auto; padding-top: 15px; border-top: 1px solid #eee;">
          <a href="#">
              
              <span>Log Out</span>
          </a>
      </li>
      </ul>
      <div class="user-menu-footer">
        <div id="userUidDisplay" class="user-uid-display" style="display: none;">UID:</div>
      </div>
    </div> <!-- End of user-menu-content -->
  </div>
  
  <!-- Menu Overlay -->
  <div id="menuOverlay"></div>
  
  <!-- Icon Bar (Favorite & Feedback) -->
  <div id="iconBar" style="display: none;">
    <button id="favoriteButton">‚òÜ</button>
    <button id="feedbackButton">üí¨</button>
  </div>
  
  <!-- Custom Quiz Modal Form -->
  <div id="customQuizForm" class="modalForm">
    <h2>Custom Quiz Options</h2>
    <div class="formGroup">
      <label for="categorySelect">Select Category</label>
      <select id="categorySelect">
        <option value="">All</option>
        <option value="Head & Neck Surgery">Head & Neck Surgery</option>
        <option value="Otology">Otology</option>
        <option value="Laryngology">Laryngology</option>
        <option value="Rhinology">Rhinology</option>
        <option value="Pediatric ENT">Pediatric ENT</option>
        <option value="Facial Plastics">Facial Plastics</option>
      </select>
    </div>
    <div class="formGroup">
      <label for="customNumQuestions">Number of Questions</label>
      <input type="number" id="customNumQuestions" min="1" value="10">
    </div>
    <div class="formGroup">
      <label>
        <input type="checkbox" id="includeAnsweredCheckbox">
        Include answered questions
      </label>
    </div>
    <div class="btnRow">
      <button id="startCustomQuiz">Start Quiz</button>
      <button id="cancelCustomQuiz" class="cancel">Cancel</button>
    </div>
  </div>
  
  <!-- Random Quiz Modal Form -->
  <div id="randomQuizForm" class="modalForm">
    <h2>Random Quiz Options</h2>
    <div class="formGroup">
      <label for="randomNumQuestions">Number of Questions</label>
      <input type="number" id="randomNumQuestions" min="1" value="10">
    </div>
    <div class="formGroup">
      <label>
        <input type="checkbox" id="includeAnsweredRandomCheckbox">
        Include answered questions
      </label>
    </div>
    <div class="btnRow">
      <button id="startRandomQuiz">Start Quiz</button>
      <button id="cancelRandomQuiz" class="cancel">Cancel</button>
    </div>
  </div>
  
  <!-- Feedback Modal -->
  <div id="feedbackModal" style="display:none; position: fixed; top:0; left:0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1700; justify-content: center; align-items: center;">
    <div style="background: #fff; padding: 20px; border-radius: 6px; width: 90%; max-width: 400px;">
      <h3>Feedback</h3>
      <p id="feedbackQuestionInfo" style="font-size:0.9rem; color:#333;"></p>
      <textarea id="feedbackText" placeholder="Enter your feedback here" style="width:100%; height:100px;"></textarea>
      <br>
      <button id="submitFeedback">Submit Feedback</button>
      <button id="closeFeedbackModal">Close</button>
    </div>
  </div>
  
  <!-- Contact Us Modal -->
  <div id="contactModal">
    <div>
      <h3>Contact Us</h3>
      <p>Please let us know your thoughts or any issues you're experiencing with MedSwipe.</p>
      <label for="contactEmail">Your Email (Optional):</label>
      <input type="email" id="contactEmail" placeholder="you@example.com">
      <textarea id="contactMessage" placeholder="Enter your message here" style="height:100px;"></textarea>
      <br>
      <button id="submitContact">Submit</button>
      <button id="closeContactModal">Cancel</button>
    </div>
  </div>

  <!-- =================================== -->
<!-- == Account Settings Modal        == -->
<!-- =================================== -->
<div class="auth-modal" id="editProfileModal" style="display: none;">
  <div class="auth-modal-content">
    <button class="auth-close-btn" id="closeEditProfileModal">√ó</button>
    <h2 id="editProfileTitle">Account Settings</h2>
    <div id="editProfileMessage" class="auth-error" style="min-height: 20px;"></div>

    <!-- View Mode Content -->
    <div id="profileViewMode">
      <div class="form-group">
        <label>Username</label>
        <div class="profile-view-field">
          <span id="viewUsername"></span>
          <a href="#" id="changeUsernameLink" class="change-link">Change</a>
        </div>
      </div>
      <div class="form-group">
        <label>Experience Level</label>
        <div class="profile-view-field">
          <span id="viewExperienceLevel"></span>
          <a href="#" id="changeExperienceLink" class="change-link">Change</a>
        </div>
        <div class="form-group">
          <label>Spaced Repetition Intervals (Days)</label>
          <div class="profile-view-field">
            <span>Hard: <b id="viewHardInterval">1</b></span>
            <span>Medium: <b id="viewMediumInterval">3</b></span>
            <span>Easy: <b id="viewEasyInterval">7</b></span>
            <a href="#" id="changeIntervalsLink" class="change-link">Change</a>
          </div>
        </div>
      </div>
      <div class="form-group">
        <label>Haptics Feedback</label>
        <div class="profile-view-field">
          <span id="viewHapticsStatus">On</span>
          <a href="#" id="changeHapticsLink" class="change-link">Change</a>
        </div>
      </div>
      <div class="auth-buttons" style="margin-top: 30px;">
         <button type="button" id="editProfileDoneBtn" class="auth-primary-btn">Done</button>
      </div>
      <div class="delete-account-section">
        <button type="button" id="deleteAccountBtn" class="auth-danger-btn">Delete Account</button>
      </div>
    </div>

    <!-- Edit Mode Content (Initially Hidden) -->
    <div id="profileEditMode" style="display: none;">
      <form id="editProfileForm">
        <div class="form-group">
          <label for="editUsername">Username</label>
          <input type="text" id="editUsername" required minlength="3">
          <small>Must be at least 3 characters.</small>
        </div>
        <div class="form-group">
          <label for="editExperienceLevel">Experience Level</label>
          <select id="editExperienceLevel" required>
            <option value="" disabled>-- Select Level --</option>
            <option value="Medical Student">Medical Student</option>
            <option value="PGY-1">PGY-1</option>
            <option value="PGY-2">PGY-2</option>
            <option value="PGY-3">PGY-3</option>
            <option value="PGY-4">PGY-4</option>
            <option value="PGY-5">PGY-5</option>
            <option value="Fellow">Fellow</option>
            <option value="Attending">Attending</option>
          </select>
        </div>
        <div class="form-group">
          <h4>Spaced Repetition Intervals</h4>
          <div class="interval-settings-container">
            <div class="interval-setting">
              <label for="editHardInterval">Hard (days)</label>
              <input type="number" id="editHardInterval" min="1" required>
            </div>
            <div class="interval-setting">
              <label for="editMediumInterval">Medium (days)</label>
              <input type="number" id="editMediumInterval" min="1" required>
            </div>
            <div class="interval-setting">
              <label for="editEasyInterval">Easy (days)</label>
              <input type="number" id="editEasyInterval" min="1" required>
            </div>
          </div>
          <small>Set the number of days until you review a question again.</small>
        </div>
        <div class="form-group">
          <label for="editHapticsToggle">Haptics Feedback</label>
          <div class="profile-toggle">
            <label>
              <input type="checkbox" id="editHapticsToggle">
              Enable vibration feedback
            </label>
          </div>
        </div>
        <div class="auth-buttons">
          <button type="submit" id="saveProfileChangesBtn" class="auth-primary-btn">Save Changes</button>
          <button type="button" id="cancelProfileChangesBtn" class="auth-secondary-btn">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Account Confirmation Modal -->
<div id="deleteAccountModal" class="auth-modal" style="display: none;">
  <div class="auth-modal-content small-modal">
    <h3>Delete Account</h3>
    <p class="delete-account-warning">
      Deleting your MedSwipe account permanently removes your progress and purchases. This does not cancel your App Store subscription; visit Settings ‚Üí Apple ID ‚Üí Subscriptions to stop future charges.
    </p>
    <div class="auth-buttons horizontal">
      <button type="button" id="cancelDeleteAccountBtn" class="auth-secondary-btn">Cancel</button>
      <button type="button" id="confirmDeleteAccountBtn" class="auth-primary-btn">OK</button>
    </div>
  </div>
</div>

  <!-- Firebase SDK -->
<script type="module" src="firebase-config.js"></script>

<!-- Auth Scripts - Must be loaded after Firebase -->
<script type="module" src="auth.js"></script>
<script type="module" src="user-profile.js"></script>

<script>
  const urlParams = new URLSearchParams(window.location.search);
  const fromLanding = urlParams.get('from') === 'landing';
  const shouldRegister = urlParams.get('register') === 'true';
  const isNativeApp = !!window.Capacitor && (window.Capacitor.isNativePlatform?.() ?? window.Capacitor.platform !== 'web');

if (isNativeApp) {
  document.body.classList.remove('hide-for-redirect');
}

  
  // Only redirect if explicitly coming to root page and not from landing, Capacitor AND not trying to register
  if (!isNativeApp && !location.hash && !fromLanding && !shouldRegister) {
    
    // Hide ALL content immediately for potential redirects
    document.body.classList.add('hide-for-redirect');
    
    // Set a flag to track if we should redirect
    let shouldRedirect = true;
    
    // Listen for the auth state change event
    window.addEventListener('authStateChanged', function(event) {
      if (!event.detail.isLoading) {
        // Auth is loaded, check if user is registered
        if (event.detail.isRegistered && !event.detail.user?.isAnonymous) {
          // User is properly logged in, show all content and don't redirect
          document.body.classList.remove('hide-for-redirect');
          shouldRedirect = false;
        } else {
          // User is anonymous or not registered, redirect
          if (shouldRedirect) {
            location.replace('homepage.html');
          }
        }
      }
    });
    
    // Fallback: if no auth event fires within 1 second, redirect
    setTimeout(() => {
      if (shouldRedirect && (!window.authState?.user || window.authState.user.isAnonymous)) {
        location.replace('homepage.html');
      }
    }, 1000);
  }
</script>

<!-- Include Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>

<!-- Chart.js for the doughnut chart -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<!-- App Scripts -->
<script type="module" src="haptics.js"></script>
<script type="module" src="utils.js"></script>
<script type="module" src="user.v2.js"></script>
<script type="module" src="quiz.js"></script>
<script type="module" src="stats.js"></script>
<script type="module" src="ui.js"></script>
<script src="./native-config.js" defer></script>
<script type="module" src="app.js"></script>
<script type="module" src="referral.js"></script>
<script type="module" src="login-screen.js"></script>
<script src="tos-privacy.js"></script>
  <script>
  // Register the service worker
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('/pwabuilder-sw.js')
        .then(function(registration) {
          console.log('Service Worker registered successfully with scope: ', registration.scope);
        })
        .catch(function(err) {
          console.log('Service Worker registration failed: ', err);
        });
    });
  }
</script>
<!-- Terms of Service Modal -->
<div id="termsOfServiceModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Terms of Use ‚Äì MedSwipe</h2>
      <span class="close-modal">&times;</span>
    </div>
    <div class="modal-body">
      <p>Effective Date: April 30, 2025</p>
      <p>By accessing or using MedSwipe, you ("User" or "you") agree to these Terms of Use ("Terms"). If you do not agree, do not use the App.</p>
      
      <h3>1. Scope of Service</h3>
      <p>MedSwipe provides educational content for licensed healthcare professionals. It is not a source of patient-specific medical advice.</p>
      <p>You are responsible for safeguarding your login credentials and any activity that occurs under your account.</p>
      
      <h3>2. Access Tiers and Subscription Plans</h3>
      <p>MedSwipe offers the following access tiers:</p>
      <ul>
        <li><strong>Free Tier:</strong> Limited access to approximately 50 basic questions. No access to CME certificates, leaderboards, spaced repetition, or advanced analytics.</li>
        <li><strong>Board Review Tier:</strong> Full access to the entire question bank, analytics, spaced repetition, and leaderboards. CME tracking is included, but certificate claiming requires a separate CME plan or pay-per-credit.</li>
        <li><strong>CME Tier:</strong> Includes all Board Review features plus access to AMA PRA Category 1 Credit‚Ñ¢ CME certificates.</li>
      </ul>
      
      <p><strong>Board Review Plan Options (All Auto-Renew):</strong></p>
      <ul>
        <li>Monthly</li>
        <li>3-Month</li>
        <li>Annual</li>
      </ul>
      
      <p><strong>CME Plan Options:</strong></p>
      <ul>
        <li>Annual CME Subscription ‚Äì billed upfront; auto-renews annually unless canceled at least 24 hours before the renewal date.</li>
        <li>Pay-per-Credit ‚Äì purchase CME credits in advance; each certificate claim deducts from your credit balance.</li>
      </ul>
      
      <p><strong>Payment Processor:</strong> All payments are handled via Stripe. By subscribing, you agree to Stripe's Terms of Service and Privacy Policy.</p>
      
      <h3>3. Pricing, Refunds, and Payment Terms</h3>
      <p><strong>Price Changes:</strong> We may adjust pricing with at least 30 days' notice via email or in-app message.</p>
      <p><strong>Refund Policy:</strong> Sales are final. Refunds for unused purchases within 14 days may be considered at our discretion.</p>
      <p><strong>Failed Payments:</strong> Stripe may retry failed payments. Unresolved payment issues may result in suspension of access to paid features.</p>
      
      <h3>4. Intellectual Property</h3>
      <p>All questions, explanations, UI elements, and trademarks are the property of MedSwipe or its licensors. Copying, reproducing, or distributing any content without written permission is prohibited.</p>
      
      <h3>5. Continuing Medical Education (CME)</h3>
      <p>CME credits are provided only through accredited activities. A maximum of 24 <i>AMA PRA Category 1 Credits‚Ñ¢</i> may be claimed per activity cycle. Users must complete required evaluations and provide accurate learner information to receive credit.</p>
      
      <h3>6. Communications & Email Updates</h3>
      <p>You agree to receive essential transactional communications (e.g., receipts, CME certificates).</p>
      <p>If you opt in, you may also receive occasional updates about new features, educational content, or app improvements. You can unsubscribe from these non-essential emails at any time.</p>
      
      <h3>7. Termination & Suspension</h3>
      <p>We reserve the right to suspend or terminate accounts for violation of these Terms, payment failure, or misuse (e.g., scraping, sharing credentials). Outstanding charges remain payable.</p>
      
      <h3>8. Limitation of Liability</h3>
      <p>MedSwipe is not liable for indirect, incidental, or consequential damages. Educational content is not a substitute for clinical judgment.</p>
      
      <h3>9. Governing Law & Dispute Resolution</h3>
      <p>These Terms are governed by the laws of California. Any disputes will be resolved via binding arbitration in Los Angeles County, unless a party seeks injunctive relief in court.</p>
      
      <h3>10. Changes to Terms</h3>
      <p>We may revise these Terms at any time. Significant changes will be communicated via email or in-app notice. Continued use of MedSwipe after such notice constitutes acceptance.</p>
      
      <!-- START: New Referral Program Clause -->
      <h3>11. Referral Program</h3>
      <p>MedSwipe may offer a Referral Program ("Program") that allows eligible users ("Referrers") to earn a reward by referring new users ("Referees") to the App.</p>
      
      <p><strong>a. Eligibility:</strong> To be eligible to participate as a Referrer, you must have an active paid subscription or be within an active free trial period. A Referee must be a new user who has never previously held a MedSwipe account.</p>
      
      <p><strong>b. Qualifying Referral:</strong> A "Qualifying Referral" occurs when a Referee:
        <ul>
          <li>Signs up for a new MedSwipe account directly through the Referrer‚Äôs unique referral link; and</li>
          <li>Successfully subscribes to a paid plan and begins their free trial period.</li>
        </ul>
      </p>
      
      <p><strong>c. Rewards:</strong> Upon a Qualifying Referral, the Referrer is eligible to receive one (1) free month of service, and the Referee is eligible to receive an additional seven (7) days added to their initial free trial period ("Rewards").</p>
      
      <p><strong>d. Reward Fulfillment:</strong> Rewards are not automatically applied. They are processed manually. Please allow approximately 7 business days after a Qualifying Referral for the Reward to be reflected in your account. For Referrers, the free month will be applied as an extension to the end of your current billing cycle. MedSwipe is not responsible for any delays in processing Rewards.</p>
      
      <p><strong>e. Limitations:</strong>
        <ul>
          <li>You may not refer yourself or create multiple accounts to benefit from the Program.</li>
          <li>Referral links are intended for personal, non-commercial use and should not be published or distributed on commercial websites (e.g., coupon websites, Reddit) or used for spam.</li>
          <li>Rewards are non-transferable and have no cash value.</li>
        </ul>
      </p>
      
      <p><strong>f. Termination and Changes:</strong> MedSwipe reserves the right to modify, suspend, or terminate the Referral Program at any time, for any reason, without notice. We also reserve the right to disqualify any user from participation and void any accrued Rewards if we find evidence of fraud, spam, or any violation of these Terms.</p>
      <!-- END: New Referral Program Clause -->

      <h3>12. Contact</h3>
      <p>For questions or concerns, email <a href="mailto:support@medswipeapp.com">support@medswipeapp.com</a>.</p>
    </div>
  </div>
</div>

<!-- Privacy Policy Modal -->
<div id="privacyPolicyModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Privacy Policy ‚Äì MedSwipe</h2>
      <span class="close-modal">&times;</span>
    </div>
    <div class="modal-body">
      <p>Effective Date: April 30 2025</p>
      <p>MedSwipe ("we," "our," or "us") respects your privacy. This Privacy Policy explains what data we collect, how we use it, and the choices you have when using the MedSwipe mobile and web application (the "App").</p>
      
      <h3>Information We Collect</h3>
      <ul>
        <li><strong>Account Information:</strong> When you register with an email address, we collect your name (if provided) and email to create your account and authenticate you.</li>
        <li><strong>Usage Information:</strong> Through Firebase analytics, we record the questions you answer, scores, CME credits earned, timestamps, device type, and IP address. This helps us improve content, generate CME certificates, and ensure platform integrity.</li>
        <li><strong>Payment Information (Processed by Stripe):</strong> When you purchase a subscription or pay-per-credit package, your billing details and card data are submitted directly to Stripe. MedSwipe receives only non-sensitive data (e.g., Stripe customer ID, plan type, last four digits of the card) needed for receipts, subscription status, and fraud prevention. Stripe's separate Privacy Policy governs its handling of your payment data.</li>
        <li><strong>Communications:</strong> If you email support, respond to surveys, or opt into marketing updates, we keep those messages so we can respond and improve our services. You may unsubscribe from non-transactional emails at any time.</li>
      </ul>
      
      <h3>How We Use Your Information</h3>
      <ul>
        <li>Provide, maintain, and improve the App and its educational content</li>
        <li>Track CME progress and generate verifiable certificates</li>
        <li>Process payments and manage subscriptions via Stripe</li>
        <li>Detect and prevent fraud or misuse</li>
        <li>Send transactional emails (e.g., receipts, CME certificates) and, with your consent, occasional product updates or promotions</li>
      </ul>
      
      <h3>Sharing and Disclosure</h3>
      <ul>
        <li><strong>Service Providers:</strong> We share data only with trusted vendors essential to our operations‚ÄîFirebase (hosting/analytics) and Stripe (payments). Each provider may process data solely to deliver its service.</li>
        <li><strong>Legal & Safety:</strong> We may disclose information if required by law or to protect our rights, users, or the public.</li>
        <li><strong>No Sales:</strong> We do not sell or rent your personal information.</li>
      </ul>
      
      <h3>Data Security</h3>
      <p>We use HTTPS/TLS encryption, restrict internal access on a need-to-know basis, and regularly review security controls. Full card numbers are never handled or stored by MedSwipe.</p>
      
      <h3>Your Rights</h3>
      <p>Depending on your jurisdiction (e.g., CCPA, GDPR), you may have rights to access, correct, delete, or port your data, and to object to certain processing. Email <a href="mailto:support@medswipeapp.com">support@medswipeapp.com</a> to make a request.</p>
      
      <h3>Data Retention</h3>
      <ul>
        <li><strong>Account & CME records:</strong> retained for the life of the account and up to 7 years after deletion (for accreditation audits).</li>
        <li><strong>Payment metadata:</strong> retained for required tax/accounting periods (usually 7 years).</li>
        <li><strong>Support emails:</strong> retained for up to 2 years.</li>
      </ul>
      
      <h3>International Transfers</h3>
      <p>If you access the App outside the United States, your information may be transferred to‚Äîand processed in‚Äîthe U.S. We rely on appropriate safeguards such as Standard Contractual Clauses where required.</p>
      
      <h3>Changes to This Policy</h3>
      <p>We may revise this Policy from time to time. Material changes will be announced via email or in-App notice. Continued use after the effective date constitutes acceptance.</p>
      
      <h3>Contact</h3>
      <p>Questions about privacy? Email <a href="mailto:support@medswipeapp.com">support@medswipeapp.com</a>.</p>
    </div>
  </div>
</div>

<!-- *** ADD THIS ENTIRE MODAL STRUCTURE *** -->
<!-- CME Claim History Modal -->
<div id="cmeHistoryModal" class="modal"> <!-- Use the existing 'modal' class -->
  <div class="modal-content"> <!-- Use existing 'modal-content' class -->
    <div class="modal-header"> <!-- Use existing 'modal-header' class -->
      <h2>CME Claim History</h2>
      <span class="close-modal">√ó</span> <!-- Standard close button -->
    </div>
    <div class="modal-body" id="cmeHistoryModalBody" style="max-height: 60vh; overflow-y: auto;">
      <!-- History content will be loaded here by JavaScript -->
      <p>Loading history...</p>
    </div>
  </div>
</div>
<!-- *** END OF NEW MODAL STRUCTURE *** -->

<!-- START: New Referral Modal -->
<div id="referralModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Share Your Referral Link</h2>
      <span class="close-modal">&times;</span>
    </div>
    <div class="modal-body" style="text-align: center;">
      <p>Share this link with your friends. When they sign up and start a trial, you'll get a free month added to your subscription and they'll get an extra week on their free trial!</p>
      
      <div class="referral-link-container">
        <input type="text" id="referralLinkInput" readonly value="Generating your link...">
        <button id="copyLinkBtn" class="auth-primary-btn">Copy</button>
      </div>
      <p id="copyConfirmation" style="color: #28a745; font-weight: 500; min-height: 20px; margin-top: 10px;"></p>
    </div>
  </div>
</div>
<!-- END: New Referral Modal -->

 <!-- Forgot Password Modal -->
<div id="forgotPasswordModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Reset Password</h2>
      <span class="close-modal">&times;</span>
    </div>
    <div class="modal-body">
      <p>Enter your email address below and we'll send you a link to reset your password.</p>
      
      <form id="forgotPasswordForm">
        <div class="form-group">
          <label for="resetEmail">Email Address</label>
          <input type="email" id="resetEmail" required placeholder="Enter your email">
          <div class="form-error" id="resetEmailError"></div>
        </div>
        
        <div id="resetMessage" class="reset-message"></div>
        
        <div class="form-buttons">
          <button type="submit" id="sendResetLinkBtn" class="auth-primary-btn">Send Reset Link</button>
          <button type="button" id="cancelResetBtn" class="auth-secondary-btn">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div> 

<!-- Registration Benefits Modal -->
<div id="registrationBenefitsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Unlock More with a Free Account</h2>
      <span class="close-modal">&times;</span>
    </div>
    <div class="modal-body">
      <p>You're just getting started! Create a free account in seconds to unlock these benefits:</p>
      
      <div class="benefits-list">
        <div class="benefit-item">
          <div class="benefit-icon">üèÜ</div>
          <div class="benefit-text">
            <h3>Leaderboards & Rankings</h3>
            <p>Compare your progress with other medical professionals</p>
          </div>
        </div>
        
        <div class="benefit-item">
          <div class="benefit-icon">üîÑ</div>
          <div class="benefit-text">
            <h3>Spaced Repetition Learning</h3>
            <p>Optimize your learning with our intelligent review system</p>
          </div>
        </div>
        
        <div class="benefit-item">
          <div class="benefit-icon">üìä</div>
          <div class="benefit-text">
            <h3>Subject-Specific Analytics</h3>
            <p>Track your performance across different subspecialties</p>
          </div>
        </div>
        
        <div class="benefit-item">
          <div class="benefit-icon">üíæ</div>
          <div class="benefit-text">
            <h3>Save Your Progress</h3>
            <p>Never lose your progress, even when switching devices</p>
          </div>
        </div>
      </div>
      
      <div class="registration-options">
        <button id="createAccountBenefitsBtn" class="auth-primary-btn">Create Free Account</button>
        <button id="continueAsGuestBtn" class="auth-secondary-btn" onclick="document.getElementById('registrationBenefitsModal').style.display='none'; document.getElementById('mainOptions').style.display='flex';">Continue as Guest</button>
      </div>
    </div>
  </div>
</div>

<!-- ========================== -->
<!-- == CME Dashboard View == -->
<!-- ========================== -->
<div id="cmeDashboardView" style="display: none; padding: 20px; margin-top: 60px; max-width: 600px; margin-left: auto; margin-right: auto;"> <!-- Start hidden, centered -->
    <h2 style="text-align: center; color: #0056b3; margin-bottom: 20px;">CME Dashboard</h2>

    <!-- Start CME Quiz Button -->
    <div class="cme-dashboard-buttons">
        <!-- Using start-quiz-btn class for consistency, adjust if needed -->
        <button id="startCmeQuizBtn" class="start-quiz-btn">Start Quiz</button>
        <button id="reviewIncorrectCmeBtn" class="start-quiz-btn">Review Incorrect</button>
    </div>

    <!-- CME Tracker Card -->
    <div id="cmeTrackerCard" class="dashboard-card" style="width: 100%; margin-bottom: 20px;">
        <div class="card-header">
            <h3>CME Tracker</h3>
        </div>
        <div class="card-content" id="cmeTrackerContent" style="padding: 15px;">
            <!-- Stats will be loaded here by JS -->
            <p>Loading tracker data...</p>
        </div>
        <div class="card-footer" style="justify-content: center;">
             <!-- Using auth-primary-btn for styling, adjust if needed -->
             <button id="claimCmeBtn" class="auth-primary-btn" style="padding: 8px 15px;" disabled>Claim CME Credits</button>
        </div>
    </div>

    <!-- CME Credit History Card -->
    <div id="cmeHistoryCard" class="dashboard-card" style="width: 100%; margin-bottom: 20px;">
        <div class="card-header">
            <h3>CME Credit History</h3>
        </div>
        <div class="card-content" id="cmeHistoryContent" style="padding: 15px; max-height: 200px; overflow-y: auto;">
            <!-- History will be loaded here by JS -->
            <p>No credits claimed yet.</p>
        </div>
         <div class="card-footer">
            <span>View Past Claims</span>
            <span class="arrow-icon">‚Üí</span>
        </div>
    </div>

    <!-- How CME Credits Work Card -->
    <div id="cmeInfoCard" class="dashboard-card" style="width: 100%; margin-bottom: 20px;">
        <div class="card-header">
            <h3>How CME Credits Work</h3>
        </div>
        <div class="card-content" style="padding: 15px; font-size: 0.9rem; line-height: 1.5;">
            <ul>
                <li>Answer CME-eligible questions within the CME Module.</li>
                <li>Score at least 70% overall on questions attempted for CME credit.</li>
                <li>Every 12 questions answered (with >=70% accuracy) earns approximately 1 CME credit. (1 question = 4.8 min).</li>
                <li>You can claim credits in increments of 0.25 (i.e., after every ~3 questions meeting the criteria).</li>
                <li>Master the Material: Re-answer questions as many times as needed to achieve the 70% accuracy for credit.</li>
                <li>Claim available credits anytime using the "Claim CME Credits" button.</li>
                <li>A short evaluation is required before generating your certificate.</li>
                <li>Certificates are downloadable and available on the dashboard at any time.</li>
            </ul>
        </div>
    </div>

      <!-- START: New Accreditation Info Button/Link -->
    <div style="text-align: center; margin-top: 20px; margin-bottom: 10px;">
      <button id="viewCmeAccreditationBtn" class="auth-secondary-btn" style="padding: 8px 15px; font-size: 0.9rem;">
          View Accreditation Statement
      </button>
  </div>
  <!-- END: New Accreditation Info Button/Link -->

   <!-- Back Button -->
   <div style="text-align: center; margin-top: 20px;">
        <button id="cmeDashboardBackBtn" class="start-quiz-btn">Back to Main Dashboard</button>
   </div>

</div> <!-- End of cmeDashboardView -->

<!-- ========================== -->
<!-- == CME Quiz Setup Modal == -->
<!-- ========================== -->
<div id="cmeQuizSetupModal" class="modalForm" style="display: none; z-index: 2150;"> <!-- Start hidden, ensure high z-index -->
    <h2>CME Quiz Setup</h2>
    <p style="font-size: 0.9rem; color: #555; text-align: center; margin-bottom: 15px;">Only questions marked as CME-eligible will be included.</p>

    <div class="formGroup">
        <label for="cmeCategorySelect">Select Category (Optional):</label>
        <select id="cmeCategorySelect">
            <option value="">All CME Questions</option>
            <!-- Options will be populated by JS later -->
        </select>
        <small class="formHelper">Leave as "All" to include questions from any category.</small>
    </div>

    <div class="formGroup">
        <label for="cmeNumQuestions">Number of Questions:</label>
        <input type="number" id="cmeNumQuestions" value="12" min="1" max="50" step="1">
         <small class="formHelper">Choose between 1 and 50 questions (12 questions = 1 credit).</small>
    </div>

    <div class="formGroup">
         <div class="terms-checkbox" style="margin-top: 10px;"> <!-- Reusing terms-checkbox style for layout -->
             <input type="checkbox" id="cmeIncludeAnsweredCheckbox">
             <label for="cmeIncludeAnsweredCheckbox">Include previously answered CME questions</label>
        </div>
         <small class="formHelper">Check this to review questions you've already answered in the CME module.</small>
    </div>

    <!-- Spaced Repetition Option is EXCLUDED as requested -->

    <div class="btnRow" style="margin-top: 20px;">
        <button type="button" id="modalCancelCmeQuizBtn" class="cancel">Cancel</button>
        <button type="button" id="modalStartCmeQuizBtn">Start CME Quiz</button>
    </div>

    <!-- Optional: Add a close button if your modalForm style doesn't include one -->
    <!-- <button id="closeCmeSetupModal" class="auth-close-btn" style="position: absolute; top: 10px; right: 15px;">√ó</button> -->

</div> <!-- End of cmeQuizSetupModal -->

<!-- ================================================== -->
<!-- Add overlay element for the modal background -->
<div id="cmeModalOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.65); z-index: 2199;"></div>

<!-- ================================================== -->
<!-- == CME Claim Modal (with Specific Evaluation) == -->
<!-- ================================================== -->
<!-- ADD the modalForm class here, REMOVE .modal-content-inner wrapper -->
<div id="cmeClaimModal" class="modalForm" style="display: none;">

  <button id="closeCmeClaimModal" class="auth-close-btn" style="position: absolute; top: 10px; right: 15px; z-index: 10;">√ó</button>
  <h2>Claim CME Credits & Evaluate</h2>

  <div id="claimModalError" class="auth-error" style="text-align: center; margin-bottom: 15px;"></div>

  <form id="cmeClaimForm">
    <!-- Full Name -->
    <div class="formGroup">
        <label for="certificateFullName">Full Name:</label>
        <input type="text" id="certificateFullName" name="certificateFullName" required placeholder="Enter your full name as you want it on the certificate">
        <small class="formHelper" style="display: block; margin-top: 5px;">This name will appear on your CME certificate.</small>
    </div>

    <!-- Degree -->
    <div class="formGroup">
        <label for="certificateDegree">Degree:</label>
        <select id="certificateDegree" name="certificateDegree" required>
            <option value="">Select your degree</option>
            <option value="MD">MD</option>
            <option value="DO">DO</option>
            <option value="PA-C">PA-C</option>
            <option value="NP">NP</option>
            <option value="RN">RN</option>
            <option value="Other">Other</option>
        </select>
        <small class="formHelper" style="display: block; margin-top: 5px;">Select your professional degree.</small>
    </div>

    <!-- NEW: License Number -->
    <div class="formGroup">
      <label for="licenseNumber">License Number:</label>
      <input type="text" id="licenseNumber" name="licenseNumber" required placeholder="Enter your professional license number">
      <small class="formHelper" style="display: block; margin-top: 5px;">Required for our records.</small>
  </div>

   <!-- CORRECTED: Location (City and State) -->
   <div class="formGroup">
    <div style="display: flex; gap: 15px; align-items: flex-end;">
        <div style="flex: 2;">
            <label for="locationCity">City:</label>
            <input type="text" id="locationCity" name="locationCity" required placeholder="Enter your city">
        </div>
        <div style="flex: 1;">
            <label for="locationState">State:</label>
            <select id="locationState" name="locationState" required>
                <option value="">Select</option>
                <option value="AL">Alabama</option>
                <option value="AK">Alaska</option>
                <option value="AZ">Arizona</option>
                <option value="AR">Arkansas</option>
                <option value="CA">California</option>
                <option value="CO">Colorado</option>
                <option value="CT">Connecticut</option>
                <option value="DE">Delaware</option>
                <option value="DC">District Of Columbia</option>
                <option value="FL">Florida</option>
                <option value="GA">Georgia</option>
                <option value="HI">Hawaii</option>
                <option value="ID">Idaho</option>
                <option value="IL">Illinois</option>
                <option value="IN">Indiana</option>
                <option value="IA">Iowa</option>
                <option value="KS">Kansas</option>
                <option value="KY">Kentucky</option>
                <option value="LA">Louisiana</option>
                <option value="ME">Maine</option>
                <option value="MD">Maryland</option>
                <option value="MA">Massachusetts</option>
                <option value="MI">Michigan</option>
                <option value="MN">Minnesota</option>
                <option value="MS">Mississippi</option>
                <option value="MO">Missouri</option>
                <option value="MT">Montana</option>
                <option value="NE">Nebraska</option>
                <option value="NV">Nevada</option>
                <option value="NH">New Hampshire</option>
                <option value="NJ">New Jersey</option>
                <option value="NM">New Mexico</option>
                <option value="NY">New York</option>
                <option value="NC">North Carolina</option>
                <option value="ND">North Dakota</option>
                <option value="OH">Ohio</option>
                <option value="OK">Oklahoma</option>
                <option value="OR">Oregon</option>
                <option value="PA">Pennsylvania</option>
                <option value="RI">Rhode Island</option>
                <option value="SC">South Carolina</option>
                <option value="SD">South Dakota</option>
                <option value="TN">Tennessee</option>
                <option value="TX">Texas</option>
                <option value="UT">Utah</option>
                <option value="VT">Vermont</option>
                <option value="VA">Virginia</option>
                <option value="WA">Washington</option>
                <option value="WV">West Virginia</option>
                <option value="WI">Wisconsin</option>
                <option value="WY">Wyoming</option>
            </select>
        </div>
    </div>
    <small class="formHelper" style="display: block; margin-top: 5px;">City and State are required for our records.</small>
</div>
<!-- END CORRECTION -->


    <!-- Credits to Claim -->
    <div class="formGroup">
        <label for="creditsToClaimInput">Credits to Claim:</label>
        <input type="number" id="creditsToClaimInput" name="creditsToClaimInput" value="0.25" min="0.25" step="0.25" required style="max-width: 100px; display: inline-block; margin-left: 10px;">
        <small class="formHelper" style="display: block; margin-top: 5px;">Available: <span id="claimModalAvailableCredits">0.00</span>. Enter amount in increments of 0.25.</small>
    </div>

    <hr style="margin: 25px 0;">

    <h3 style="text-align: center; color: #0056b3; margin-bottom: 10px;">Evaluation Questions:</h3>

    <!-- DESIRED OUTCOMES Table -->
    <div class="formGroup">
        <h4 style="text-align: left; margin-bottom: 10px; color: #333; font-size: 1.1em; font-weight: 500;">DESIRED OUTCOMES ‚Äì As a result of this activity, are you now better able to:</h4>
        <table class="evaluation-table">
            <thead>
                <tr>
                    <th style="width: 30px;">#</th>
                    <th style="text-align: left;">Outcome</th>
                    <th style="width: 60px;">YES</th>
                    <th style="width: 60px;">NO</th>
                    <th style="width: 60px;">N/A</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1.</td>
                    <td>Evaluate knowledge and competence in screening, diagnosing, and treating patients with ear, nose, and throat (ENT) conditions</td>
                    <td><input type="radio" name="desiredOutcome1" value="Yes" required></td>
                    <td><input type="radio" name="desiredOutcome1" value="No"></td>
                    <td><input type="radio" name="desiredOutcome1" value="N/A"></td>
                </tr>
                <tr>
                    <td>2.</td>
                    <td>Adhere to clinical guidelines and protocols within ENT medicine</td>
                    <td><input type="radio" name="desiredOutcome2" value="Yes" required></td>
                    <td><input type="radio" name="desiredOutcome2" value="No"></td>
                    <td><input type="radio" name="desiredOutcome2" value="N/A"></td>
                </tr>
                <tr>
                    <td>3.</td>
                    <td>Recognize knowledge gaps in ENT disease states and identify resources to assist in closing those gaps</td>
                    <td><input type="radio" name="desiredOutcome3" value="Yes" required></td>
                    <td><input type="radio" name="desiredOutcome3" value="No"></td>
                    <td><input type="radio" name="desiredOutcome3" value="N/A"></td>
                </tr>
                <tr>
                    <td>4.</td>
                    <td>Apply evidence-based strategies in ENT diagnosis and management</td>
                    <td><input type="radio" name="desiredOutcome4" value="Yes" required></td>
                    <td><input type="radio" name="desiredOutcome4" value="No"></td>
                    <td><input type="radio" name="desiredOutcome4" value="N/A"></td>
                </tr>
                <tr>
                    <td>5.</td>
                    <td>Recognize vulnerable patient populations and consider how cultural disparities and implicit bias may impact the appropriate care of these patients</td>
                    <td><input type="radio" name="desiredOutcome5" value="Yes" required></td>
                    <td><input type="radio" name="desiredOutcome5" value="No"></td>
                    <td><input type="radio" name="desiredOutcome5" value="N/A"></td>
                </tr>
            </tbody>
        </table>
        <small class="formHelper" style="display: block; margin-top: 5px;">All "Desired Outcomes" questions (1-5) are required.</small>
    </div>

    <!-- Open-ended Question 1 -->
    <div class="formGroup" style="margin-top: 25px;">
        <label for="evalPracticeChangesText" style="font-weight: 500; font-size: 1.1em;">1. WHAT CHANGES WILL YOU MAKE TO YOUR PRACTICE AS A RESULT OF THIS ACTIVITY?</label>
        <textarea id="evalPracticeChangesText" name="evalPracticeChangesText" rows="4" placeholder="Describe any changes... (Optional)"></textarea>
    </div>

    <!-- Open-ended Question 2 -->
    <div class="formGroup">
        <label for="evalCommercialBiasExplainText" style="font-weight: 500; font-size: 1.1em;">2. IF YOU PERCEIVED ANY COMMERCIAL BIAS IN THIS ACTIVITY, PLEASE EXPLAIN:</label>
        <textarea id="evalCommercialBiasExplainText" name="evalCommercialBiasExplainText" rows="3" placeholder="Explain any perceived commercial bias... (Optional)"></textarea>
    </div>

    <!-- Buttons -->
    <div class="btnRow" style="margin-top: 25px;">
        <button type="button" id="cancelCmeClaimBtn" class="cancel">Cancel</button>
        <button type="submit" id="submitCmeClaimBtn">Submit Claim & Get Certificate</button>
    </div>
</form>

  <!-- Download Link Area -->
  <div id="claimModalLink" style="text-align: center; margin: 15px 0; display: none;"> <!-- Start hidden, shown via JS -->
      <!-- Content added dynamically by JS -->
  </div>

  <!-- Loading Indicator -->
  <div id="claimLoadingIndicator" style="display: none; text-align: center; margin-top: 15px;">
       <div class="spinner" style="margin: 0 auto 10px;"></div>
       <p style="color: #0C72D3;">Processing claim...</p>
  </div>

</div> <!-- End of cmeClaimModal -->
 
<!-- ========================== -->
<!-- == CME Info/Paywall Screen == -->
<!-- ========================== -->
<div id="cmeInfoScreen" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #FFFFFF; z-index: 2100; padding: 20px; box-sizing: border-box; overflow-y: auto; flex-direction: column; align-items: center; text-align: center;">

  <!-- Back Button (Top Left) -->
  <button id="cmeInfoBackBtn" class="cme-back-btn">‚Üê Back</button>
  
  <!-- Content Area -->
  <div style="max-width: 600px; width: 100%; margin-top: 50px;"> <!-- Added margin-top for back button space -->

      <img src="MedSwipe Logo gradient.png" alt="MedSwipe Logo" style="max-width: 150px; margin-bottom: 5px;">

      <h1 style="color: #0056b3; font-size: 1.4rem; margin-bottom: 15px;">Earn <i>AMA PRA Category 1 Credits‚Ñ¢</i> ‚Äì Anytime, Anywhere</h1>

      <ul style="list-style: none; padding: 0; margin-bottom: 25px; text-align: left; display: inline-block;">
          <li style="margin-bottom: 10px; font-size: 1.1rem;"><span style="color: #0056b3; margin-right: 8px;">‚Ä¢</span> Jointly provided by <strong>CME Consultants</strong> and <strong>MedSwipe</strong></li>
          <li style="margin-bottom: 10px; font-size: 1.1rem;"><span style="color: #0056b3; margin-right: 8px;">‚Ä¢</span> Earn up to 24 <i>AMA PRA Category 1 Credits‚Ñ¢</i></li>
          <li style="margin-bottom: 10px; font-size: 1.1rem;"><span style="color: #0056b3; margin-right: 8px;">‚Ä¢</span> Re-answer questions as needed to earn credits.</li>
          <li style="margin-bottom: 10px; font-size: 1.1rem;"><span style="color: #0056b3; margin-right: 8px;">‚Ä¢</span> Instant printable certificates on demand</li>
      </ul>

      <!-- Sample Certificate Preview -->
      <div class="certificate-preview" style="margin-bottom: 20px; text-align: center;">
           <!-- You will need to create or find an image that looks like your desired sample certificate -->
           <!-- Replace 'path/to/your/sample-certificate.png' with the actual path to your image -->
          <img src="Certificate example.png" alt="Sample CME Certificate" class="certificate-image" style="max-width: 50%; height: auto; border: 1px solid #ccc; box-shadow: 2px 2px 5px rgba(0,0,0,0.1);">
      </div>

      <!-- Action Buttons -->
<div style="margin-bottom: 15px;">
  <button id="unlockCmeBtn" class="auth-primary-btn cme-unlock-button">Unlock CME Access</button>
</div>

<!-- START: New Accreditation Statement Button -->
<div style="margin-bottom: 15px;">
  <button id="viewAccreditationInfoBtn" class="auth-secondary-btn" style="padding: 10px 20px; font-size: 1rem;">Accreditation Statement</button>
</div>
<!-- END: New Accreditation Statement Button -->

<div>
  <a href="#" id="learnMoreCmeLink" class="cme-learn-more-link">Learn more</a>
</div>

  </div> <!-- End Content Area -->

</div> <!-- End cmeInfoScreen -->

<!-- ========================== -->
<!-- == CME Pricing Screen == -->
<!-- ========================== -->
<!-- Inside index.html -->
<!-- ========================== -->
<!-- == CME Pricing Screen == -->
<!-- ========================== -->
<div id="cmePricingScreen" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #f8f9fa; z-index: 2150; padding: 20px; box-sizing: border-box; overflow-y: auto; flex-direction: column; align-items: center; text-align: center;">

  <!-- Back Button (Keep As Is) -->
  <button id="cmePricingBackBtn" class="cme-back-btn">‚Üê Back</button>

  <!-- Content Area -->
  <div style="max-width: 500px; width: 100%; margin-top: 50px;"> <!-- Added margin-top -->

      <img src="MedSwipe Logo gradient.png" alt="MedSwipe Logo" style="max-width: 150px; margin-bottom: 15px;">

      <h1 style="color: #333; font-size: 1.8rem; margin-bottom: 25px;">CME Access Options</h1>

      <!-- *** START: Restored Tab Toggle *** -->
      <div class="cme-pricing-toggle" style="margin-bottom: 30px;">
          <button id="cmeAnnualBtn" class="toggle-btn active">ANNUAL</button>
          <button id="cmePayPerCreditBtn" class="toggle-btn">PAY-PER-CREDIT</button>
      </div>
      <!-- *** END: Restored Tab Toggle *** -->

      <!-- *** START: Annual Content Container (Initially Visible) *** -->
      <div id="cmeAnnualContent" style="display: block;"> <!-- Use block or flex -->
          <div id="cmeAnnualPriceDisplay" style="font-size: 2.8rem; font-weight: bold; color: #333; margin-bottom: 25px;">
              $179/year
          </div>
          <ul id="cmeAnnualFeatureList" style="list-style: none; padding: 0; margin-bottom: 35px; text-align: left; display: inline-block;">
              <!-- Keep your existing annual features -->
              <li style="margin-bottom: 12px; font-size: 1.1rem;"><span style="color: #28a745; margin-right: 10px;">‚úî</span> Over 60% less than other CME providers</li>
              <li style="margin-bottom: 12px; font-size: 1.1rem;"><span style="color: #28a745; margin-right: 10px;">‚úî</span> ~1 CME credit per 12 questions (‚â•70% accuracy)</li>
              <li style="margin-bottom: 12px; font-size: 1.1rem;"><span style="color: #28a745; margin-right: 10px;">‚úî</span> Re-answer missed questions as needed to get credit</li>
              <li style="margin-bottom: 12px; font-size: 1.1rem;"><span style="color: #28a745; margin-right: 10px;">‚úî</span> Claim up to 24 <i>AMA PRA Category 1 Credits‚Ñ¢</i></li>
              <li style="margin-bottom: 12px; font-size: 1.1rem;"><span style="color: #28a745; margin-right: 10px;">‚úî</span> Track progress & download certificates</li>
          </ul>
          <div>
              <!-- Keep the renamed Annual button -->
              <button id="cmeCheckoutAnnualBtn" class="auth-primary-btn" style="width: 80%; max-width: 300px; padding: 15px; font-size: 1.2rem; font-weight: bold;">Start 7-Day Free Trial</button>
          </div>
      </div>
      <!-- *** END: Annual Content Container *** -->

      <!-- *** START: Pay-Per-Credit Content Container (Initially Hidden) *** -->
      <div id="cmePayPerCreditContent" style="display: none;">
          <div id="cmeCreditPriceDisplay" style="font-size: 1.8rem; font-weight: bold; color: #333; margin-bottom: 15px;">
              $8.00 <span style="font-size: 1rem; font-weight: normal; color: #555;">per Credit</span>
          </div>
           <p style="font-size: 0.9rem; color: #666; margin-bottom: 25px;">Purchase credits for claiming CME certificates.</p>
          <ul id="cmeCreditFeatureList" style="list-style: none; padding: 0; margin-bottom: 35px; text-align: left; display: inline-block;">
              <!-- Add the new features -->
              <li style="margin-bottom: 12px; font-size: 1.0rem;"><span style="color: #28a745; margin-right: 10px;">‚úî</span> Purchase 1‚Äì24 CME credits as you need them</li>
              <li style="margin-bottom: 12px; font-size: 1.0rem;"><span style="color: #28a745; margin-right: 10px;">‚úî</span> 1 CME credit per 12 questions (‚â•70% accuracy)</li>
              <li style="margin-bottom: 12px; font-size: 1.0rem;"><span style="color: #28a745; margin-right: 10px;">‚úî</span> Pay only for what you use‚Äîno commitment</li>
              <li style="margin-bottom: 12px; font-size: 1.0rem;"><span style="color: #28a745; margin-right: 10px;">‚úî</span> Track progress & download certificates</li>
          </ul>
          <!-- Keep the quantity input and Buy Credits button -->
          <div class="form-group" style="max-width: 200px; margin: 15px auto;">
              <label for="creditQty" style="display: block; margin-bottom: 5px; font-weight: 500;">Number of Credits (1-24):</label>
              <input type="number" id="creditQty" name="creditQty" min="1" max="24" value="1" required style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 1rem; text-align: center;">
          </div>
          <button id="cmeBuyCreditsBtn" class="auth-primary-btn" style="width: 80%; max-width: 300px; padding: 12px; font-size: 1.1rem; font-weight: bold; margin-top: 10px;">Buy Credits</button>
      </div>
      <!-- *** END: Pay-Per-Credit Content Container *** -->

  </div> <!-- End Content Area -->

</div> <!-- End cmePricingScreen -->

<!-- ============================= -->
<!-- == CME Learn More Modal == -->
<!-- ============================= -->
<div id="cmeLearnMoreModal" class="modal" style="z-index: 2200;"> <!-- Use base modal class, ensure high z-index -->
  <div class="modal-content cme-learn-more-content"> <!-- Add specific class for styling -->
      <div class="modal-header">
          <h2>MedSwipe CME Module</h2>
          <span id="closeCmeLearnMoreModal" class="close-modal">√ó</span>
      </div>
      <div class="modal-body">

          <h3>What is this CME module?</h3>
          <p>This is a self-paced, mobile-accessible CME experience built into the MedSwipe quiz platform. Answer clinically relevant multiple choice questions, track your progress, and claim CME credits ‚Äî all in one place and done at your own pace.</p>

          <h3>What do I get?</h3>
          <ul style="list-style: none; padding-left: 5px;">
              <li style="margin-bottom: 8px;"><span style="color: #0C72D3; margin-right: 8px;">‚Ä¢</span> Swipeable MCQs in the exact format as the regular version of MedSwipe but now with the ability to claim CME credits</li>
              <li style="margin-bottom: 8px;"><span style="color: #0C72D3; margin-right: 8px;">‚Ä¢</span> ~1 <i>AMA PRA Category 1 Credit‚Ñ¢</i> for every 12 questions answered with ‚â•70% accuracy</li>
              <li style="margin-bottom: 8px;"><span style="color: #0C72D3; margin-right: 8px;">‚Ä¢</span> 300+ CME-eligible questions</li>
              <li style="margin-bottom: 8px;"><span style="color: #0C72D3; margin-right: 8px;">‚Ä¢</span> Ability to claim up to 24 <i>AMA PRA Category 1 Credits‚Ñ¢</i></li>
              <li style="margin-bottom: 8px;"><span style="color: #0C72D3; margin-right: 8px;">‚Ä¢</span> Unlimited Attempts: Re-answer questions as often as needed to solidify your knowledge and earn credits.</li>
              <li style="margin-bottom: 8px;"><span style="color: #0C72D3; margin-right: 8px;">‚Ä¢</span> Downloadable, printable CME certificates</li>
              <li style="margin-bottom: 8px;"><span style="color: #0C72D3; margin-right: 8px;">‚Ä¢</span> Automatic tracking of your CME progress</li>
              <li style="margin-bottom: 8px;"><span style="color: #0C72D3; margin-right: 8px;">‚Ä¢</span> No extra steps ‚Äî earn as you learn</li>
          </ul>

          <h3>Who accredits this?</h3>
          <p>This activity is jointly provided by MedSwipe and CME Consultants, and has been planned and implemented in accordance with the ACCME accreditation requirements.</p>

          <!-- START: Added Accreditation Statement -->
          <h3>Accreditation Statement</h3>
          <p>This activity has been planned and implemented in accordance with the accreditation requirements and policies of the Accreditation Council for Continuing Medical Education (ACCME) through the joint providership of CME Consultants and MedSwipe. CME Consultants is accredited by the ACCME to provide continuing medical education for physicians.</p>
          <p>CME Consultants designates this enduring material for a maximum of 24.0 <i>AMA PRA Category 1 Credits‚Ñ¢</i>. Physicians should claim only the credit commensurate with the extent of their participation in the activity.</p>
          <p>There was no commercial support for this activity.</p>
          <p>The planners, authors, and reviewers of this activity have no relevant financial relationships to disclose.</p>
          <p><strong>Credit Term:</strong> June 10, 2025 - June 9, 2026</p>

          <h3>How do credits get calculated?</h3>
          <p>We award ~1 credit for every 12 questions answered correctly (at least 70% correct), based on user testing that showed an average time of ~5 minutes per question. <strong>Feel free to re-attempt questions to reach the accuracy threshold!</strong></p>

          <h3>Is this accepted by my hospital/board?</h3>
          <p>Yes ‚Äî these credits are Category 1 AMA PRA credits, accepted for:</p>
          <ul style="list-style: disc; padding-left: 25px;">
              <li>State licensure requirements</li>
              <li>Maintenance of Certification (MOC)</li>
              <li>Hospital privileges and credentialing</li>
          </ul>

          <h3>How do I claim a certificate?</h3>
          <p>Once you earn at least 0.25 credits your certificate becomes available for download in the CME Dashboard. You can download and submit it anytime.</p>

          <!-- Action Buttons -->
          <div class="cme-learn-more-buttons" style="margin-top: 25px; display: flex; flex-direction: column; gap: 10px; align-items: center;">
              <button id="continueToCheckoutBtn" class="auth-primary-btn" style="width: 90%; max-width: 300px;">Continue to Checkout</button>
              <button id="returnToDashboardBtn" class="auth-secondary-btn" style="width: 90%; max-width: 300px;">Return to Main Dashboard</button>
          </div>

      </div> <!-- End modal-body -->
  </div> <!-- End modal-content -->
</div> <!-- End cmeLearnMoreModal -->

<!-- ===================================== -->
<!-- == CME Accreditation Statement Modal == -->
<!-- ===================================== -->
<div id="cmeAccreditationModal" class="modal" style="z-index: 2250;"> <!-- Ensure high z-index -->
  <div class="modal-content">
    <div class="modal-header">
      <h2>Accreditation Information</h2>
      <span id="closeCmeAccreditationModal" class="close-modal">√ó</span>
    </div>
    <div class="modal-body">
      <p>This activity has been planned and implemented in accordance with the accreditation requirements and policies of the Accreditation Council for Continuing Medical Education (ACCME) through the joint providership of CME Consultants and MedSwipe. CME Consultants is accredited by the ACCME to provide continuing medical education for physicians.</p>
      <p>CME Consultants designates this enduring material for a maximum of 24.0 <i>AMA PRA Category 1 Credits‚Ñ¢</i>. Physicians should claim only the credit commensurate with the extent of their participation in the activity.</p>
      <p>There was no commercial support for this activity.</p>
      <p>The planners, authors, and reviewers of this activity have no relevant financial relationships to disclose.</p>
      <p><strong>Credit Term:</strong> June 10, 2025 - June 9, 2026 <!-- <<< IMPORTANT: REPLACE THIS PLACEHOLDER --></p>
      <!-- You might want to add a small note about where to find more info if needed -->
      <p style="margin-top: 20px; font-size: 0.85em; color: #555;">
        For further details regarding accreditation, please refer to the information provided during the CME module purchase or contact support.
      </p>
    </div>
  </div>
</div>
<!-- ========================================= -->
<!-- == END CME Accreditation Statement Modal == -->
<!-- ========================================= -->

<div id="boardReviewCmeModal" class="modal" style="display: none; z-index: 2350;">
  <div class="modal-content">
    <div class="modal-header">
      <h2>CME Access</h2>
      <span class="close-modal">√ó</span>
    </div>
    <div class="modal-body" style="text-align: center;">
      <p style="margin-bottom: 20px;">Please contact us at <a href="mailto:support@medswipeapp.com">support@medswipeapp.com</a> if you would like to add CME Access to your subscription.</p>
      <button id="boardReviewCmeModalCloseBtn" class="auth-primary-btn">Got it</button>
    </div>
  </div>
</div>

<!-- ======================================== -->
<!-- == Post-Purchase Registration Modal == -->
<!-- ======================================== -->
<div id="postPurchaseRegistrationModal" class="modal" style="display: none; z-index: 2300;">
  <div class="modal-content registration-followup-modal">
    <div class="modal-header">
      <h2>You're all set!</h2>
      <span class="close-modal" data-dismiss-modal="postPurchaseRegistrationModal">√ó</span>
    </div>
    <div class="modal-body">
      <p>Complete registration to stay updated on MedSwipe features and access your account on other devices.</p>
    </div>
    <div class="modal-footer registration-followup-actions">
      <button id="postPurchaseRegisterBtn" class="auth-primary-btn">Register Now</button>
      <button id="postPurchaseMaybeLaterBtn" class="auth-secondary-btn">Maybe Later</button>
    </div>
  </div>
</div>

<!-- ===================================== -->
<!-- == Free Access Registration Modal == -->
<!-- ===================================== -->
<div id="freeAccessRegistrationModal" class="modal" style="display: none; z-index: 2300;">
  <div class="modal-content registration-followup-modal">
    <div class="modal-header">
      <h2>Keep your progress safe</h2>
      <span class="close-modal" data-dismiss-modal="freeAccessRegistrationModal">√ó</span>
    </div>
    <div class="modal-body">
      <p>Create an account to stay updated on MedSwipe features and access your account on other devices.</p>
    </div>
    <div class="modal-footer registration-followup-actions">
      <button id="freeAccessRegisterBtn" class="auth-primary-btn">Create Account</button>
      <button id="freeAccessMaybeLaterBtn" class="auth-secondary-btn">Maybe Later</button>
    </div>
  </div>
</div>

<!-- =================================== -->
<!-- == NEW Question Image Modal      == -->
<!-- =================================== -->
<div id="questionImageModal" class="modal" style="z-index: 2500;">
  <div class="modal-content" style="max-width: 90%; max-height: 90vh; padding: 10px; background-color: #fff;">
    <span id="closeImageModal" class="close-modal">&times;</span>
    <img id="modalImage" src="" alt="Question Image" style="width: 100%; height: auto; max-height: 85vh; object-fit: contain; display: block;">
  </div>
</div>
<!-- =================================== -->
<!-- == END Question Image Modal      == -->
<!-- =================================== -->

<script>
  // Check if we should show registration form
  window.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      
      if (urlParams.get('register') === 'true') {
          // Wait for auth and app to initialize
          setTimeout(function() {
              // Remove the hide-for-redirect class if it was added
              document.body.classList.remove('hide-for-redirect');
              
              // Show the welcome screen first
              const welcomeScreen = document.getElementById('welcomeScreen');
              if (welcomeScreen) {
                  welcomeScreen.style.display = 'flex';
                  welcomeScreen.style.opacity = '1';
              }
              
              // Then show the registration form
              setTimeout(function() {
                  if (typeof showRegisterForm === 'function') {
                      showRegisterForm();
                  } else if (typeof window.showRegisterForm === 'function') {
                      window.showRegisterForm();
                  }
              }, 500);
          }, 1500);
      }
  });
  </script>
</body>
</html>
